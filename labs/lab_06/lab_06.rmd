---
title: "lab_06"
author: "Mitchell Hang"
date: "2022-03-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries and establish settings

```{r}
# Turn off scientific notation
options(scipen=999)

# load your libraries
library(tidyverse)
library(lubridate)
library(janitor)
```

## Getting Started

This week we'll be combining and joining data to make it more useful and to ask some questions about it. We'll use some of our 911 overdose call data to do this. The first thing we want to do is to combine multiple counties' data into a single dataframe so that we can ask some questions. First, let's combine data from Cecil, Carroll and Allegany counties into a new dataframe.

*Before* you combine them you'll need to clean up some of the column names to make the data easier to work with - make sure you have loaded the library to do that. You also need to make sure that each column has the same name and datatype (you can check the datatypes using `glimpse`). If any of them does not, you need to fix that.

```{r}
# load and combine the call data from those three counties
allegany_911 <- read_csv("data/allegany_911.csv")
carroll_911 <- read_csv("data/carroll_911.csv")
cecil_911 <- read_csv("data/cecil_911.csv")

carroll_911 <- carroll_911 %>%
  clean_names()

allegany_caroll_cecil_911 <- bind_rows(list(allegany_911, carroll_911, cecil_911))
```

Then we'll join some demographic data with Baltimore City 911 calls and ask some questions of that. For that, you'll need to load the Baltimore City 911 data and the ZCTA demographic data, and join them based on the zip code. Remember, the zip codes in both dataframes must be the same datatype (and should be characters). You should start with your Baltimore 911 dataframe in creating your join. 

```{r}
# load and join the Baltimore-related data
baltimore_911 <- read_csv("data/baltimore_911.csv")
maryland_zcta <- read_csv("data/maryland_zcta.csv")

baltimore_911 <- baltimore_911 %>%
  mutate(zip_code = as.character(zip_code))

maryland_zcta <- maryland_zcta %>% 
  mutate(ZCTA5N = as.character(ZCTA5N)) %>%
  clean_names() %>%
  rename(zip_code = zcta5n)

baltimore_911_with_maryland_zcta <- baltimore_911 %>% left_join(maryland_zcta, by="zip_code")
```

## Answer questions

Q1. Let's start with our data from Allegany, Cecil and Carroll counties. Write code to generate a dataframe that shows the total number of calls for each county. What's the order of counties from most calls to least?

A1.  The order of counties from most calls to least is Caroll County (448 calls), Cecil County (438 calls) and Allegany County (418 calls).

```{r}
allegany_caroll_cecil_911 %>%
  group_by(county) %>%
  summarize(total_calls = n()) %>%
  arrange(desc(total_calls))
```

Q2. In your combined dataframe that you used in A1, add a column for the month of each call, then write code to show the total number of calls per county and month. Are there any outliers or noteworthy results? Describe the general pattern of the results. 

Then calculate the most calls per county and location. Which location had the most calls - where and what is that location?

A2. First, I noticed that all three counties had the most calls for the month of August 2022, but Cecil County had the most calls for the three counties during that month, with 55 calls compared to 50 calls in Allegany County and 44 calls in Carroll County. There don't seem to be any noticable outliers from what I did, as the number of calls during each month is a steady change from 55 calls in August 2022 for Cecil County and 17 calls in November 22 for Allegany County (i.e., there is more or less an even distribution). 

Second, the location that had the most calls -- not just in Cecil County but for all three counties also -- was "314 GROVE NECK RD EARLEVILLE, MD" with 15 calls, and upon looking up the Zillow page, I noticed it was a fancy mansion.The Location in Allegany County that had the most calls was "19410 OLD DANS ROCK RD SW' with 5 calls, and I supect through Google Maps that it is a house in Frostburg located a few blocks from a large cylindrical tank. The location in Carroll County that had the most calls was the Cold Weather Shelter at 127 Stoner Avenue in Westminster with 11 calls, as I noticed it was written in the dataset in two different ways: "127 STONER AV, SAFE HAVEN" (6 calls) and "127 STONER AV, COLD WEATHER SHELTER" (5 calls).

```{r}
allegany_caroll_cecil_911 %>%
  mutate(month = floor_date(date, "month")) %>%
  group_by(county, month) %>%
  summarize(total_calls = n()) %>%
  arrange(desc(total_calls))
```

```{r}
allegany_caroll_cecil_911 %>%
  group_by(county, location) %>%
  summarize(total_calls = n()) %>%
  arrange(desc(total_calls))
```

Q3. Let's turn to the Baltimore City data. You're interested in exploring calls in zip codes with a high percentage of children under 18. Write code to isolate calls in zip codes where the percentage of under 18 population is at least 75% and then show the zip code and population and how many calls occurred in each of those zip codes. 

Where are those zip codes in the city?

Add a column to your code that calculates the number of calls per 1,000 people for those zip codes. To calculate a per capita rate, you might find this short guide handy: https://observablehq.com/@palewire/per-capita-calculator.

Which zip code has the highest rate of calls per 1,000 people? Find the neighborhoods in that zip code that are listed in the data - you can use group_by or distinct to do this. What are some of those neighborhoods, and what else can you tell me about the population there?

A3. The zip code with the highest rate of calls per 1,000 people is 21217, with about 20 to 21 calls for every 1,000 people. Upon checking the zip code in the dataset, I found out that 37,111 people live in the zip code, 86.4% of the population is Black (non-Hispanic), the median age is 34.3 years old, and 70% of people rent homes compared to 21.7% of homeowners. Some of this zip code's neighborhoods include Bolton Hill, Druid Heights and Upton, and I found out the latter is one of Baltimore's earliest Black middle-class neighborhoods. When comparing it to the zip code with the lowest rate of calls, 21216 (which has about 6 to 7 calls for every 1,000 people), I found that 32,071 people live there, 96.1% of the population are Black (non-Hispanic), the median age is 37.4 years old, and 49.9% of people rent homes compared to 34.5% of homeowners. Some of this zip code's neighborhoods include Bridgeview/Greenlawn, Rosemont and Winchester.

```{r}
baltimore_911_with_maryland_zcta %>%
  filter(pct_under_18 >= 75.0) %>%
  group_by(zip_code, population) %>%
  summarize(total_calls = n()) %>%
  mutate(per_capita = (total_calls/population)*1000) %>%
  arrange(desc(per_capita))
```

Q4. Choose your own adventure: I want you to come up with a question you could ask of the Baltimore City data that combines both the calls and the demographic information. You must use both demographics and the overdose call data in your work.

My question: "Out of all zip codes which have a percentage of homeowners being at least 50%, which ones have the highest and lowest rates of calls per 1,000 people?"

A4: The zip code with the highest rate of calls per 1,000 people is 21226, with about 6 calls for every 1,000 people. Much of the calls from this zip code are in the Curtis Bay neighborhood. The zip code with the lowest rate of calls per 1,000 people is 21228, with about less than 0.05 calls for every 1,000 people. Only one call was reported in that zip code, and it was in the neighborhood of Beechfield. Interestingly, 21226 has fewer people than 21228, and the former is more of an industrial area, so I wonder if much of the 911 calls are related to workplace accidents.

```{r}
baltimore_911_with_maryland_zcta %>%
  filter(pct_homeowner >= 50.0) %>%
  group_by(zip_code, population) %>%
  summarize(total_calls = n()) %>%
  mutate(per_capita = (total_calls/population)*1000) %>%
  arrange(desc(per_capita))
```
